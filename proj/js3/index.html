<html> 
<meta name="viewport" content="width=480, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1">
<body>
<script src="lib.js"></script>
<script defer>
//alert([lib.GE("q","[defer]").constructor==Object, {}.constructor==Object])
try{
//Object.prototype.toString = function() {var i, s = []; for(i in this) s.push(i + ': ' + this[i]); return '{' + s.join(',\n') + '}'}
//alert(lib);
//alert(document.constructor == HTMLDocument);
//alert(lib.GE("q","script"))
//alert(lib.Vectors.Vec([1, 2, 3]))

with(lib){
with(Vectors){
with(Vec){
//var a = Vec(1, 2, 3);
//a.subSelf(Vec(4, 5));
//alert(sub(Vec(1,2,3), Vec(4, 5)))
}
with(SqMatrix){
//alert(rotMx(deg(180),'xy'))
//var t = new Transformator();
//alert(t)
//alert(t.rot(deg(30),'xy'))
//t.rot(deg(45))
//alert(t)
//alert(1)
//var v = new Vec(1, 0)
//alert(2)
//t.proceedSelf([v]);
//alert([v.neg(), v])
//compFloatBits = 8;
//alert(compFloat(v.dims[0], v.dims[1]))
//t.rot(deg(30), 'xy');
//alert(t.rot(deg(330)))
}
//alert(0)
var __gsize = new Vec(480, 320);
var G = new Graphics(0, __gsize), GskyStatic = new Graphics(0, __gsize), Gclouds = new Graphics(0, __gsize);
//alert(1)
//alert([G.bindView(), Graphics.canvView().CTX])
//alert(Vec(480, 320))
G.bindView();
var ce = G.canv.element;
//alert([ce, G.canv.CTX, G.canv, getView(document.createElement('canvas')).element]);
document.body.appendChild(ce);
//document.write([ce.height, ce.width])
//G.loadChanges();
var v = Vec(50, 0), i, m = SqMatrix.rotMx(0.02), p = Vec(50, 50), c =  Graphics.Color([255, 0, 0, 255]);
for(i = 0; i < 6.3; i += 0.02){
G.putPixel(Vec.add(v, p), c);
v.mulSelf(m);
}
G.putPixel(Vec(479, 319), c);
//document.write(G._iData.data);
G.saveChanges();
//alert(Graphics.Color([255,255,255,127.5], 0).painted(Graphics.Color([0, 0, 255, 127.5])));
//alert(Graphics.Color())
//alert(Timer.getTS());
//alert(Timer)
var t = Timer(8000);
//alert(t.play)
t.addEventListener('tick', function(e){alert(e.ts)});
//t.play();
//alert(t._TO)
var h, l, sc;
var Resize = function(){
 h = Math.min(window.innerWidth / 480 * 320, window.innerHeight);
 l = Math.max((window.innerWidth - h / 320 * 480) / 2, 0);
 sc = 320 / h;
document.body.style.height = ce.style.height = h + 'px';
}
Resize();
addEventListener('resize', Resize, false);
G.wrapX = true;
var f = function(E){
//var e = E.touches[0], i; for(i in e){document.write(i + ':' + e[i] + '\<br /\>')}*
try{
var t, i;
for(i in E.touches){
if(+i!=i) continue;
t = E.touches[i];
//var x = (t.pageX - l) / 2, y = t.pageY / 2;
//G.putPixel(Vec(x, y), c);
G.putPixel(Vec(G.canv.getRelClickCoords(t, sc)), c);
}
//alert([x, y, c]);
G.saveChanges();
E.preventDefault();
}catch(e){alert(e)}
}
var mouseHold = false;
document.body.addEventListener('touchstart', function(){mouseHold = true}, false);
document.body.addEventListener('touchend', function(){mouseHold = false}, false);
document.body.addEventListener('touchmove', f, false);
document.body.addEventListener('mousedown', function(){mouseHold = true;}, false);
document.body.addEventListener('mouseup', function(){mouseHold = false;}, false);
document.body.addEventListener('mousemove', function(e){if(mouseHold) f({touches:[e], preventDefault: copyFunc(e, e.preventDefault)});}, false);
G.drawImg(G.canv.element, new Vec(20, 2), 0, 0, new Vec(50, 50), 0.1, new Vec(0, 0));
G.loadChanges();
var ta = document.createElement('textarea');
//ta.value = G.toUrl('image/jpeg', 0.1);
ta.onblur = function(){
try{
getView(document.body).push(View({attrs:{href: (this.value = G.toUrl()), target: '_blank'}, tagName: 'a', innerHTML: 'image'}));
//document.write(document.body.lastChild);
}catch(e){document.write(e)}
}
//document.write(document.createElement('div') + 'qwe')
/*var A = document.createElement('a');
A.innerHTML = 'ссылка';
A.setAttribute('href', '//ya.ru');
document.body.appendChild(A);*/

document.body.appendChild(ta);

//var img = document.createElement('img');
//img.src = 'atlas.png';
//img.addEventListener('load', function(){
//G.saveChanges();
//document.write(ce);
//G.drawImg(img, new Vec(10, 10), new Vec(512, 512), 0, new Vec(128, 128));
//G.loadChanges();
//}, false);

var atl = new Graphics.TileAtlas(LinkURL('atlas.png'), new Vec(64, 64), 8, 8, 4, function(){
//document.write('123');
//G.drawImg(atl.canv.element, new Vec(0, 0), new Vec(480, 320), 0, new Vec(240, 160));
//document.write(0);
//GskyStatic = new Graphics(0, new Vec(480, 320));
GskyStatic.bindView();
GskyStatic.saveChanges();
//document.write(GskyStatic.canv.height)
atl.drawTo(GskyStatic, 4, new Vec([0, 0]), 8, 1, 2);
atl.drawTo(GskyStatic, 5, new Vec([0, 64]), 8, 1, 2);
atl.drawTo(GskyStatic, 6, new Vec([0, 128]), 8, 1, 2);
atl.drawTo(GskyStatic, 7, new Vec([0, 192]), 8, 1, 2);

//Gclouds = new Graphics(0, new Vec(480, 320));
Gclouds.bindView();
Gclouds.saveChanges();
//atl.drawTo(G, 0, new Vec([32, 32]), 1, 1, 2);
//atl.drawTo(G, 3, new Vec([64, 64]), 1, 1, 2);
//atl.drawTo(G, 1, new Vec([128, 64]), 2, 1, 2);
//atl.drawTo(G, 2, new Vec([256, 64]), 1, 1, 2);
//atl.drawToMany(G, [3, 1, 1, 2, 0], new Vec([64, 64]), 4, 2);
//G.loadChanges();
//document.write(1);
tim.addEventListener('tick', function(e){try{G.cls(1); Gclouds.cls(1);
//document.write(e.frame);
 atl.drawTo(Gclouds, 0, new Vec([(e.frame * 3) % 512 - 64, 32]), 1, 1, 2); atl.drawToMany(Gclouds, [3, 1, 1, 2], new Vec([(e.frame * 7) % 736 - 256, 64]), 4, 2);
 G.drawImg(GskyStatic.canv.element);
  G.drawImg(Gclouds.canv.element);
  }catch(exc){document.write(exc)}});
tim.play();

});
//document.write(document.location);
//document.write(G.toUrl());
//ce.style.top = h - window.innerHeight + 'px';
//setTimeout(function(){alert([outerHeight, innerHeight])}, 2100);
var ray = new Graphics.Shader.Ray(new Vec([1, 0, 2]), new Vec([3, 4, 5]));
//alert([].join.apply(ray.origin, ['']));
//alert(ray.origin[2])
//ce.onclick = function(){scrollTo(0, Math.round(h - window.innerHeight + 1))};
//alert(h - window.innerHeight + 1);
tim = new Timer(50);
G.cls();
//G.saveChanges();
//document.write(Uint8ClampedArray.prototype.fill)
}
}
}catch(e){document.write('page' + e)}
//alert(document.parentNode)
//document.write(ImageData)
</script>
<script>

try{
//addEventListener('resize', function(){document.write(outerHeight / outerWidth)}, false);
with(lib, lib.Vectors){

}}catch(e){alert('page' + e)}
</script>
<style>
body {
position:absolute;
top:0px;
bottom:0px;
left:0px;
right:0px;
padding:0px;
margin:0px;
text-align:center;
//border:1pt solid red;
}
canvas {
//border:1pt solid gray;
background: url('transpbg.svg') repeat;
position:relative;
//margin-top:0px;
//margin-bottom:0px;
height:90%;
}
</style>
</body></html>
